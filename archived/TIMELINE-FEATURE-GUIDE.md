# ⏰ 时间轴筛选功能说明

## ✅ 已添加功能

在地图页面上方添加了交互式时间轴，用户可以通过拖拽选择时间范围来筛选考古遗址。

---

## 🎯 功能特点

### 1. **双滑块时间轴**
- 📅 时间范围：公元前 6000 年 - 公元前 1500 年
- 🎚️ 两个滑块：起始年份和结束年份
- ↔️ 拖拽滑块即可调整时间范围

### 2. **实时筛选**
- ⚡ 拖动滑块时立即筛选遗址
- 🗺️ 地图标记实时更新
- 📋 遗址列表实时更新

### 3. **显示全部按钮**
- 🔄 一键重置时间轴
- 📍 显示所有时期的遗址
- 🎯 快速返回全局视图

### 4. **可视化反馈**
- 📊 高亮显示选中的时间范围
- 🔢 实时显示遗址数量
- 📅 显示当前选择的年份区间

---

## 🎨 界面元素

```
┌─────────────────────────────────────────────┐
│  ⏰ 时间筛选                    [显示全部]  │
│  拖动滑块选择时间范围                        │
│                                             │
│  ○───────────■■■■■■■■───────────○          │
│  BC6000  BC5000  BC4000  BC3000  BC2000  BC1500│
│                                             │
│  当前选择：公元前 5000 - 3000 年              │
│  显示遗址：12 个                             │
└─────────────────────────────────────────────┘
```

---

## 🔧 使用方法

### 步骤 1：拖动左侧滑块
- 📅 选择起始年份（最早的年份）
- 示例：拖到公元前 5000 年

### 步骤 2：拖动右侧滑块
- 📅 选择结束年份（最晚的年份）
- 示例：拖到公元前 3000 年

### 步骤 3：查看筛选结果
- 🗺️ 地图上只显示该时间范围内的遗址
- 📋 下方列表同步更新
- 🔢 显示筛选后的遗址数量

### 步骤 4：显示全部（可选）
- 🔄 点击右上角"显示全部"按钮
- 📍 时间轴重置到完整范围
- 🌍 显示所有遗址

---

## 💡 筛选逻辑

### 数据来源

时间轴筛选使用以下字段：
1. **startYear** - 遗址开始年份（BCE）
2. **endYear** - 遗址结束年份（BCE）
3. **era** / **date** - 年代字符串（自动解析）

### 筛选规则

遗址显示的条件：
```
遗址的存续时间 与 选择的时间范围 有交集
```

具体判断：
```javascript
遗址开始年份 >= 选择的结束年份 
且
遗址结束年份 <= 选择的起始年份
```

### 示例

**选择：公元前 5000 - 3000 年**

✅ 显示：
- 仰韶文化（公元前 5000-4000 年）- 有交集
- 龙山文化（公元前 4500-3000 年）- 有交集
- 大地湾（公元前 5500-3500 年）- 有交集

❌ 不显示：
- 二里头（公元前 1900-1500 年）- 无交集
- 红山文化（公元前 6000-5000 年）- 无交集

---

## 📝 在 Studio 中添加数据

为了让时间轴筛选正常工作，建议在添加遗址时填写：

### 必填字段
- **地点**：遗址位置
- **文化/遗址**：文化类型
- **年代**：例如 `公元前5000–4000年`
- **社会与权力特征**：社会描述

### 推荐字段（用于精确筛选）
- **开始年份（BCE）**：`5000`（数字）
- **结束年份（BCE）**：`4000`（数字）

**注意**：年份是 BCE（Before Common Era），即公元前的年份。

---

## 🎯 时间轴刻度说明

| 刻度 | 说明 | 典型文化 |
|------|------|---------|
| BC 6000 | 公元前6000年 | 新石器早期 |
| BC 5000 | 公元前5000年 | 仰韶文化早期 |
| BC 4000 | 公元前4000年 | 仰韶文化晚期 |
| BC 3000 | 公元前3000年 | 龙山文化 |
| BC 2000 | 公元前2000年 | 夏朝时期 |
| BC 1500 | 公元前1500年 | 商朝时期 |

---

## 🚀 技术实现

### HTML5 Range Input
使用两个重叠的 `<input type="range">` 实现双滑块效果。

### 实时更新
```javascript
slider.addEventListener('input', function() {
    updateTimeline();  // 更新显示
    filterByTimeline(); // 筛选数据
});
```

### 智能解析
如果数据中没有 `startYear`/`endYear`，会自动从 `era` 字段解析：
- "公元前5000–4000年" → startYear: 5000, endYear: 4000
- "公元前5000年" → startYear: 5250, endYear: 4750 (±250年)

---

## 📊 数据统计

时间轴会实时显示：
- 📅 当前选择的时间范围
- 🔢 筛选后的遗址数量
- 📈 与总数的对比

---

## 🎨 样式特点

### 1. **渐变背景**
时间轴使用紫色渐变，从浅到深表示时间流逝。

### 2. **高亮选区**
选中的时间范围会用深紫色高亮显示。

### 3. **圆形滑块**
- 紫色圆形滑块
- 白色边框
- 悬停时放大效果
- 投影效果

### 4. **响应式设计**
- 在移动设备上也能正常拖动
- 自适应不同屏幕尺寸

---

## 🔄 与其他筛选的关系

时间轴筛选 **独立工作**：
- ✅ 可以单独使用时间轴筛选
- ✅ 也可以同时使用文化类型筛选按钮
- ✅ 两种筛选会叠加效果

**建议使用流程**：
1. 先用时间轴选择大致时期
2. 再用文化类型按钮细化筛选

---

## ⚙️ 配置选项

如果需要修改时间范围，在代码中调整：

```javascript
// 修改最小/最大年份
<input type="range" 
    id="timeline-start" 
    min="6000"  // 最早年份
    max="1500"  // 最晚年份
    value="6000" 
    step="100"> // 步进值
```

修改刻度标签：
```html
<div class="timeline-mark">
    <div>公元前6000年</div>
</div>
```

---

## 🐛 故障排除

### Q: 拖动滑块没有反应？
**A:** 
- 检查浏览器控制台是否有错误
- 确认 JavaScript 已加载
- 刷新页面重试

### Q: 筛选结果不准确？
**A:** 
- 检查数据中是否填写了 `startYear` 和 `endYear`
- 或确保 `era` 字段格式正确（例如："公元前5000–4000年"）
- 查看控制台日志了解解析结果

### Q: 移动端拖动不流畅？
**A:** 
- 这是原生 range input 的限制
- 如需更好的体验，可以使用第三方库（如 noUiSlider）

### Q: 如何显示公元后的年份？
**A:** 
需要修改代码支持负数年份：
```javascript
min="-1500"  // 公元后1500年
max="6000"   // 公元前6000年
```

---

## 🎓 使用场景

### 1. **研究特定时期**
选择公元前 5000-3000 年，专注研究仰韶文化时期。

### 2. **对比不同时期**
- 先选择公元前 5000-4000 年（仰韶早期）
- 再选择公元前 3000-2000 年（龙山时期）
- 对比社会变迁

### 3. **教学演示**
拖动时间轴，直观展示文化的兴衰过程。

### 4. **数据探索**
快速筛选不同时期，发现数据规律。

---

## 📱 移动端适配

时间轴在移动设备上完全可用：
- ✅ 支持触摸拖动
- ✅ 滑块大小适中，易于操作
- ✅ 自适应屏幕宽度
- ✅ 文字大小适配

---

## 🚀 未来改进

可以考虑的增强功能：
1. **动画播放**：自动从古到今播放
2. **快速跳转**：点击特定时期快速跳转
3. **多段选择**：同时选择多个不连续的时间段
4. **历史事件标记**：在时间轴上标注重要事件
5. **时间精度切换**：年/十年/百年精度切换

---

## 📚 相关文档

- **MAP-FIX-GUIDE.md** - 地图修复说明
- **HOW-TO-USE.md** - 完整使用指南
- **SYSTEM-STATUS.md** - 系统状态确认

---

**享受使用时间轴探索中国母系考古文化的旅程吧！** ⏰🗺️

*功能添加时间：2025-11-09*


